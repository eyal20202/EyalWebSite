---
import BaseLayout from '@layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const blogPosts = await getCollection('blog', ({ data }) => !data.draft);
  return blogPosts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

interface Props {
  post: CollectionEntry<'blog'>;
}

const { post } = Astro.props;
const { Content } = await post.render();
const formattedDate = new Intl.DateTimeFormat('he-IL', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
}).format(post.data.date);
---

<BaseLayout
  title={post.data.title}
  description={post.data.description}
  image={post.data.image}
>
  <main class="min-h-screen py-12">
    <article class="container-custom max-w-4xl">
      <!-- Header -->
      <header class="mb-12">
        <div class="mb-6">
          <a href="/blog" class="inline-flex items-center gap-2 text-sm text-gray-400 hover:text-primary-300 transition-colors mb-6 group">
            <svg class="w-4 h-4 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
            חזרה לבלוג
          </a>
        </div>
        
        {post.data.tags.length > 0 && (
          <div class="flex flex-wrap gap-2 mb-6">
            {post.data.tags.map((tag) => (
              <span class="px-4 py-1.5 rounded-full text-xs font-medium bg-primary-500/20 text-primary-200 border border-primary-500/30">
                #{tag}
              </span>
            ))}
          </div>
        )}
        
        <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold text-white mb-6 leading-tight">
          {post.data.title}
        </h1>
        
        <p class="text-xl text-gray-300 mb-8 leading-relaxed">
          {post.data.description}
        </p>
        
        <div class="flex flex-wrap items-center gap-6 text-sm">
          <div class="flex items-center gap-2 text-gray-400">
            <svg class="w-5 h-5 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
            <time datetime={post.data.date.toISOString()}>{formattedDate}</time>
          </div>
          {post.data.readingTime && (
            <div class="flex items-center gap-2 text-gray-400">
              <svg class="w-5 h-5 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <span>{post.data.readingTime} דקות קריאה</span>
            </div>
          )}
          {post.data.author && (
            <div class="flex items-center gap-2 text-gray-400">
              <svg class="w-5 h-5 text-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
              </svg>
              <span>{post.data.author}</span>
            </div>
          )}
        </div>
      </header>

      <!-- Featured Image -->
      {post.data.image && (
        <div class="relative mb-12 rounded-2xl overflow-hidden shadow-2xl">
          <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent z-10"></div>
          <img
            src={post.data.image}
            alt={post.data.title}
            class="w-full h-64 md:h-96 object-cover"
            loading="eager"
          />
        </div>
      )}

      <!-- Content -->
      <div class="blog-content">
        <Content />
      </div>
      
      <style>
        .blog-content {
          @apply max-w-none;
        }
        
        /* Headings */
        .blog-content :global(h1) {
          @apply text-4xl md:text-5xl font-extrabold text-white mb-8 mt-12 leading-tight;
          background: linear-gradient(to right, rgb(255 255 255), rgb(148 163 184));
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
        }
        
        .blog-content :global(h2) {
          @apply text-3xl md:text-4xl font-bold text-primary-200 mt-16 mb-8 leading-tight pb-4 border-b border-white/10;
        }
        
        .blog-content :global(h3) {
          @apply text-2xl md:text-3xl font-semibold text-white mt-12 mb-6 leading-tight;
        }
        
        .blog-content :global(h4) {
          @apply text-xl md:text-2xl font-semibold text-gray-200 mt-10 mb-4;
        }
        
        /* Paragraphs */
        .blog-content :global(p) {
          @apply text-gray-300 leading-relaxed mb-6 text-base md:text-lg;
        }
        
        /* Links */
        .blog-content :global(a) {
          @apply text-primary-300 font-medium no-underline transition-all;
          background: linear-gradient(to right, rgb(14 165 233), rgb(165 47 255));
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
        }
        
        .blog-content :global(a:hover) {
          @apply underline;
          background: linear-gradient(to right, rgb(56 189 248), rgb(192 132 252));
          -webkit-background-clip: text;
          -webkit-text-fill-color: transparent;
          background-clip: text;
        }
        
        /* Strong/Bold */
        .blog-content :global(strong) {
          @apply text-white font-bold;
        }
        
        /* Lists */
        .blog-content :global(ul),
        .blog-content :global(ol) {
          @apply text-gray-300 my-8 space-y-3;
        }
        
        .blog-content :global(ul) {
          @apply list-disc list-outside mr-6;
        }
        
        .blog-content :global(ol) {
          @apply list-decimal list-outside mr-6;
        }
        
        .blog-content :global(li) {
          @apply mb-3 leading-relaxed text-base md:text-lg;
        }
        
        .blog-content :global(li::marker) {
          @apply text-primary-400 font-bold;
        }
        
        /* Code */
        .blog-content :global(code:not(pre code)) {
          @apply text-primary-300 bg-white/10 px-2 py-1 rounded text-sm font-mono;
          border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Code Blocks */
        .blog-content :global(pre) {
          @apply bg-neutral-900 border border-white/10 rounded-2xl p-6 md:p-8 overflow-x-auto my-8;
          box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        
        .blog-content :global(pre code) {
          @apply bg-transparent text-gray-200 p-0 border-0;
          font-size: 0.9rem;
          line-height: 1.7;
        }
        
        /* Blockquotes */
        .blog-content :global(blockquote) {
          @apply border-r-4 border-primary-500 pr-6 pl-4 py-4 italic text-gray-300 bg-primary-500/10 rounded-l-xl my-8;
          border-left: none;
        }
        
        .blog-content :global(blockquote p) {
          @apply mb-0;
        }
        
        /* Tables */
        .blog-content :global(table) {
          @apply w-full my-8 rounded-xl overflow-hidden border border-white/10;
          background: rgba(255, 255, 255, 0.03);
        }
        
        .blog-content :global(thead) {
          @apply bg-white/5;
        }
        
        .blog-content :global(th) {
          @apply border-b-2 border-white/20 pb-4 pt-4 px-6 font-bold text-white text-right;
        }
        
        .blog-content :global(td) {
          @apply border-b border-white/10 py-4 px-6 text-gray-300 text-right;
        }
        
        .blog-content :global(tbody tr:hover) {
          @apply bg-white/5;
        }
        
        .blog-content :global(tbody tr:last-child td) {
          @apply border-b-0;
        }
        
        /* Images */
        .blog-content :global(img) {
          @apply rounded-2xl shadow-2xl my-10 w-full h-auto;
          border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Horizontal Rule */
        .blog-content :global(hr) {
          @apply border-white/10 my-12;
          border-top: 2px solid;
          border-bottom: none;
          border-left: none;
          border-right: none;
        }
        
        /* Mermaid diagrams */
        .blog-content :global(.mermaid) {
          @apply my-10 rounded-2xl p-6 bg-white/5 border border-white/10;
        }
      </style>

      <!-- Footer -->
      <footer class="mt-16 pt-12 border-t border-white/10">
        <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6">
          <div>
            <h3 class="text-lg font-semibold text-white mb-4">שתף את המאמר</h3>
            <div class="flex gap-3">
              <a
                href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(post.data.title)}&url=${encodeURIComponent(Astro.url.href)}`}
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-gray-300 hover:text-white hover:bg-white/10 hover:border-primary-500/30 transition-all group"
              >
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                </svg>
                <span>Twitter</span>
              </a>
              <a
                href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.href)}`}
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-gray-300 hover:text-white hover:bg-white/10 hover:border-primary-500/30 transition-all group"
              >
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
                <span>LinkedIn</span>
              </a>
              <button
                onclick="navigator.share({title: document.title, url: window.location.href})"
                class="flex items-center gap-2 px-4 py-2 rounded-xl bg-white/5 border border-white/10 text-gray-300 hover:text-white hover:bg-white/10 hover:border-primary-500/30 transition-all"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                </svg>
                <span>שתף</span>
              </button>
            </div>
          </div>
          <a
            href="/blog"
            class="inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-gradient-to-r from-primary-500 to-brand-500 text-white hover:shadow-lg hover:shadow-primary-500/50 transition-all font-medium"
          >
            <span>עוד מאמרים</span>
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
          </a>
        </div>
      </footer>
    </article>
  </main>
</BaseLayout>

